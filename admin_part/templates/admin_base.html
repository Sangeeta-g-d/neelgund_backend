<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Neelgund Real Estate</title>
  <link rel="shortcut icon" type="image/png" href="/static/assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="/static/assets/css/styles.min.css" />
  <!-- Toastify CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<!-- Font Awesome 6.6.0 CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">


</head>

<body>
  <!-- Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <!-- Sidebar Start -->
    <aside class="left-sidebar">
      <!-- Sidebar scroll-->
      <div>
        <div class="brand-logo d-flex align-items-center justify-content-between">
          <a href="/admin_dashboard/" class="text-nowrap logo-img">
            <img src="/static/assets/images/logos/dark-logo.svg" width="180" alt="" />
          </a>
          <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
            <i class="ti ti-x fs-8"></i>
          </div>
        </div>
        <!-- Sidebar navigation-->
        <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
          <ul id="sidebarnav">
            <li class="nav-small-cap">
              <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
              <span class="hide-menu">Home</span>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" href="/admin_dashboard/" aria-expanded="false">
                <span>
                  <i class="ti ti-layout-dashboard"></i>
                </span>
                <span class="hide-menu">Dashboard</span>
              </a>
            </li>
          
             <li class="sidebar-item">
              <a class="sidebar-link" href="/projects/" aria-expanded="false">
                <span>
                  <i class="ti ti-aperture"></i>
                </span>
                <span class="hide-menu">Projects</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" href="/agents_list/" aria-expanded="false">
                <span>
                  <i class="ti ti-aperture"></i>
                </span>
                <span class="hide-menu">Agents List</span>
              </a>
            </li>
             <li class="sidebar-item">
              <a class="sidebar-link" href="/lead_list/" aria-expanded="false">
                <span>
                  <i class="ti ti-aperture"></i>
                </span>
                <span class="hide-menu">Leads List</span>
              </a>
            </li>
             <li class="sidebar-item">
              <a class="sidebar-link" href="/customer_list/" aria-expanded="false">
                <span>
                  <i class="ti ti-aperture"></i>
                </span>
                <span class="hide-menu">Customer List</span>
              </a>
            </li>
              <li class="sidebar-item">
              <a class="sidebar-link" href="/withdrawal_requests/" aria-expanded="false">
                <span>
                  <i class="ti ti-aperture"></i>
                </span>
                <span class="hide-menu">Payment & Commissions</span>
              </a>
            </li>
             <li class="sidebar-item">
              <a class="sidebar-link" href="/marketing_tools/" aria-expanded="false">
                <span>
                  <i class="ti ti-aperture"></i>
                </span>
                <span class="hide-menu">Marketing Tools</span>
              </a>
            </li>
          </ul>
        </nav>
        <!-- End Sidebar navigation -->
      </div>
      
      <!-- End Sidebar scroll-->
    </aside>
    <!-- Sidebar End -->
    
    <!-- Main wrapper -->
    <div class="body-wrapper">
      <!-- Header Start -->
      <header class="app-header">
        <nav class="navbar navbar-expand-lg navbar-light">
          <ul class="navbar-nav">
            <li class="nav-item d-block d-xl-none">
              <a class="nav-link sidebartoggler nav-icon-hover" id="headerCollapse" href="javascript:void(0)">
                <i class="ti ti-menu-2"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link nav-icon-hover" href="javascript:void(0)">
                <i class="ti ti-bell-ringing"></i>
                <div class="notification bg-primary rounded-circle"></div>
              </a>
            </li>
          </ul>
          <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
            <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
              <li class="nav-item me-3">
                <a href="javascript:void(0)" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAmenityModal">
                  Add Amenities
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link nav-icon-hover" href="javascript:void(0)" id="drop2" data-bs-toggle="dropdown"
                  aria-expanded="false">
                  <img src="/static/assets/images/profile/user-1.jpg" alt="" width="35" height="35" class="rounded-circle">
                </a>
                <div class="dropdown-menu dropdown-menu-end dropdown-menu-animate-up" aria-labelledby="drop2">
                  <div class="message-body">
                   
                    <a href="/logout/" class="btn btn-outline-primary mx-3 mt-2 d-block">Logout</a>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </nav>
      </header>
      <!-- Header End -->

      <!-- Main Content Area -->
      <div class="container-fluid">
        <div class="row">
         {% block content %}

         {% endblock %}
        </div>
      </div>
    </div>
  </div>

  <!-- Add Amenity Modal -->
  <div class="modal fade" id="addAmenityModal" tabindex="-1" aria-labelledby="addAmenityModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4 shadow-lg">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="addAmenityModalLabel"><i class="ti ti-aperture me-2"></i>Add Amenity</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="amenityForm" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
              <label for="name" class="form-label fw-semibold">Amenity Name</label>
              <input type="text" name="name" class="form-control" id="name" placeholder="e.g. Swimming Pool" required>
            </div>
            <div class="mb-3">
              <label for="icon" class="form-label fw-semibold">Icon (optional)</label>
              <input type="file" name="icon" class="form-control" id="icon" accept="image/*">
            </div>
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-success px-4">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript Libraries -->
  <script src="/static/assets/libs/jquery/dist/jquery.min.js"></script>
  <script src="/static/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/assets/js/sidebarmenu.js"></script>
  <script src="/static/assets/js/app.min.js"></script>
  <!-- <script src="/static/assets/libs/apexcharts/dist/apexcharts.min.js"></script> -->
  <script src="/static/assets/libs/simplebar/dist/simplebar.js"></script>
  <script src="/static/assets/js/dashboard.js"></script>
  
  <!-- Toastify JS -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <script>
    $(document).ready(function () {
      // CSRF Token setup
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }

      const csrftoken = getCookie('csrftoken');

      // AJAX setup with CSRF token
      $.ajaxSetup({
        beforeSend: function(xhr, settings) {
          if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
          }
        }
      });

      // Amenity form submission
      $("#amenityForm").on("submit", function (e) {
        e.preventDefault();
        
        var formData = new FormData(this);
        var submitBtn = $(this).find('button[type="submit"]');
        
        // Disable submit button to prevent multiple submissions
        submitBtn.prop('disabled', true).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...');

        $.ajax({
          url: "{% url 'add_amenity' %}",
          type: "POST",
          data: formData,
          processData: false,
          contentType: false,
          success: function (response) {
            // Close modal and reset form
            $("#addAmenityModal").modal('hide');
            $("#amenityForm")[0].reset();
            
            // Show success message
            Toastify({
              text: response.message || "Amenity added successfully!",
              duration: 3000,
              gravity: "top",
              position: "right",
              backgroundColor: "#28a745",
              className: "toastify-success"
            }).showToast();
          },
          error: function (xhr) {
            let errorMessage = "Error adding amenity.";
            
            if (xhr.responseJSON && xhr.responseJSON.error) {
              errorMessage = xhr.responseJSON.error;
            } else if (xhr.status === 0) {
              errorMessage = "Network error. Please check your connection.";
            } else if (xhr.status === 500) {
              errorMessage = "Server error. Please try again later.";
            }
            
            Toastify({
              text: errorMessage,
              duration: 4000,
              gravity: "top",
              position: "right",
              backgroundColor: "#dc3545",
              className: "toastify-error"
            }).showToast();
          },
          complete: function () {
            // Re-enable submit button
            submitBtn.prop('disabled', false).html('Save');
          }
        });
      });

      // Reset form when modal is closed
      $('#addAmenityModal').on('hidden.bs.modal', function () {
        $("#amenityForm")[0].reset();
      });
    });
  </script>
</body>
</html>