{% extends 'admin_base.html' %}
{% load static %}
{% block content %}

<div class="container-fluid py-4 projects-page">

  <!-- Page Header -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
    <div>
      <h2 class="h4 mb-1 fw-bold text-dark">Project Management</h2>
      <p class="text-muted mb-0">Monitor and manage every project in one place</p>
    </div>
    <div class="d-flex gap-2">
      <!-- <button class="btn btn-outline-primary rounded-3" id="exportBtn">
        <i class="bi bi-download me-2"></i> Export
      </button> -->
      <a href="{% url 'add_project' %}" class="btn btn-primary rounded-3">
        <i class="bi bi-plus-circle me-2"></i> Add Project
      </a>
    </div>
  </div>

  <!-- Stats -->
  <div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card h-100 border-0 shadow-sm rounded-4 total-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Total Projects</p>
              <h3 class="fw-bold mb-0" id="totalProjects">{{ projects|length }}</h3>
            </div>
            <span class="stat-icon text-primary bg-primary bg-opacity-10">
              <i class="bi bi-kanban"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card h-100 border-0 shadow-sm rounded-4 ready-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Ready To Move</p>
              <h3 class="fw-bold mb-0" id="readyProjects">0</h3>
            </div>
            <span class="stat-icon text-success bg-success bg-opacity-10">
              <i class="bi bi-check2-circle"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card h-100 border-0 shadow-sm rounded-4 construction-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Under Construction</p>
              <h3 class="fw-bold mb-0" id="constructionProjects">0</h3>
            </div>
            <span class="stat-icon text-warning bg-warning bg-opacity-10">
              <i class="bi bi-tools"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card stat-card h-100 border-0 shadow-sm rounded-4 upcoming-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Upcoming</p>
              <h3 class="fw-bold mb-0" id="upcomingProjects">0</h3>
            </div>
            <span class="stat-icon text-info bg-info bg-opacity-10">
              <i class="bi bi-lightning-charge"></i>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card border-0 shadow-sm rounded-4 mb-4">
    <div class="card-body p-4">
      <div class="row g-3">
        <div class="col-xl-4 col-lg-5">
          <div class="position-relative">
            <i class="bi bi-search search-icon"></i>
            <input type="text" id="searchInput" class="form-control form-control-lg ps-5 rounded-3"
                   placeholder="Search projects by name, location or type">
          </div>
        </div>
        <div class="col-md-4 col-lg-3">
          <select id="statusFilter" class="form-select form-select-lg rounded-3">
            <option value="all">All Status</option>
            <option value="ready_to_move">Ready To Move</option>
            <option value="under_construction">Under Construction</option>
            <option value="upcoming">Upcoming</option>
            <option value="ongoing">Ongoing</option>
          </select>
        </div>
        <div class="col-md-4 col-lg-3">
          <select id="typeFilter" class="form-select form-select-lg rounded-3">
            <option value="all">All Types</option>
            <option value="residential">Residential</option>
            <option value="commercial">Commercial</option>
            <option value="mixed">Mixed Use</option>
          </select>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Projects Table -->
  <div class="card border-0 shadow-sm rounded-4">
    <div class="card-header bg-transparent border-0 px-4 pt-4 pb-2">
      <div class="d-flex flex-wrap justify-content-between align-items-center w-100 gap-3">
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-kanban text-primary fs-4"></i>
          <div>
            <h5 class="mb-0 fw-bold">All Projects</h5>
            <small class="text-muted">Search, filter and paginate instantly</small>
          </div>
        </div>
        <div class="d-flex align-items-center gap-2">
          <span class="text-muted small">Show:</span>
          <select class="form-select rounded-3" id="recordsPerPage" style="width: 110px;">
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive rounded-bottom-4">
        <table class="table table-hover align-middle mb-0 projects-table">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Project</th>
              <th>Location</th>
              <th>Total Plots</th>
              <th>Commission Percentage</th>
              
              <th>Status</th>
              <th class="pe-4 text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="projectsTableBody">
            {% if projects %}
              {% for project in projects %}
                <tr class="project-row"
                    data-name="{{ project.project_name|lower }}"
                    data-location="{{ project.location|default:''|lower }}"
                    data-type="{{ project.project_type|default:''|lower }}"
                    data-status="{{ project.status|default:'ongoing' }}"
                    data-plots="{{ project.total_plots|default:0 }}"
                    data-date="{{ project.created_at|date:'U' }}"
                    data-leads="0">
                  <td class="ps-4 py-3">
                    <div class="d-flex align-items-center gap-3">
                      <div class="project-avatar bg-primary bg-opacity-10 text-primary rounded-3">
                        <i class="bi bi-building"></i>
                      </div>
                      <div>
                        <h6 class="mb-1 fw-semibold text-dark project-name">{{ project.project_name }}</h6>
                        <p class="text-muted small mb-0 text-capitalize">{{ project.project_type|default:'—' }}</p>
                      </div>
                    </div>
                  </td>
                  <td class="text-muted">
                    <i class="bi bi-geo-alt me-1 text-primary"></i>
                    <span class="project-location">{{ project.location|default:'—' }}</span>
                  </td>
                  <td class="fw-semibold">{{ project.total_plots|default:'—' }}</td>
                  <td>{{ project.commission_percentage|default:'—' }}%</td>
                  
                  <td>
                    {% if project.status == "ready_to_move" %}
                      <span class="badge rounded-pill bg-success bg-opacity-10 text-success border border-success border-opacity-25">
                        <i class="bi bi-check-circle me-1"></i> Ready
                      </span>
                    {% elif project.status == "under_construction" %}
                      <span class="badge rounded-pill bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25">
                        <i class="bi bi-tools me-1"></i> Under Construction
                      </span>
                    {% elif project.status == "upcoming" %}
                      <span class="badge rounded-pill bg-info bg-opacity-10 text-info border border-info border-opacity-25">
                        <i class="bi bi-lightning me-1"></i> Upcoming
                      </span>
                    {% else %}
                      <span class="badge rounded-pill bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25">
                        <i class="bi bi-circle-half me-1"></i> Ongoing
                      </span>
                    {% endif %}
                  </td>
                  <td class="pe-4 text-center">
                    <div class="btn-group">
                      <a class="btn btn-sm btn-outline-primary rounded-3"
                         href="{% url 'project_details' project.id %}"
                         title="View Details">
                        <i class="bi bi-eye"></i>
                      </a>
                      <a class="btn btn-sm btn-outline-warning rounded-3"
                         href="{% url 'edit_project' project.id %}"
                         title="Edit Project">
                        <i class="bi bi-pencil"></i>
                      </a>
                      <button class="btn btn-sm btn-outline-danger rounded-3 delete-project-btn"
                              data-project-id="{{ project.id }}" title="Delete Project">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            {% endif %}
            <tr id="noProjectsRow" class="{% if projects %}d-none{% endif %}">
              <td colspan="7" class="text-center py-5 text-muted">
                <i class="bi bi-kanban fs-1 d-block mb-3 opacity-25"></i>
                <h5 class="text-muted">No projects found</h5>
                <p class="mb-0">Try adjusting your filters or add a new project.</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 px-4 py-3 border-top">
        <div class="text-muted small">
          Showing <strong id="showingCount">0</strong> of <strong id="totalCount">{{ projects|length }}</strong> projects
        </div>
        <nav>
          <ul class="pagination mb-0" id="pagination"></ul>
        </nav>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<style>
  .projects-page .stat-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    background: #ffffff;
  }
  .projects-page .total-card {
    background: linear-gradient(135deg, #eef2ff, #e0ecff);
  }
  .projects-page .ready-card {
    background: linear-gradient(135deg, #e8fdf4, #d3f8e5);
  }
  .projects-page .construction-card {
    background: linear-gradient(135deg, #fff7e5, #ffeccc);
  }
  .projects-page .upcoming-card {
    background: linear-gradient(135deg, #e6f7ff, #d8f0ff);
  }
  .projects-page .stat-card:hover {
    transform: translateY(-3px);
  }
  .projects-page .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 16px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
  }
  .projects-table .project-avatar {
    width: 44px;
    height: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.15rem;
  }
  .projects-table tbody tr {
    transition: background-color 0.2s ease, transform 0.2s ease;
  }
  .projects-table tbody tr:hover {
    background-color: rgba(78, 115, 223, 0.05);
    transform: translateY(-1px);
  }
  .projects-page .search-icon {
    position: absolute;
    top: 50%;
    left: 16px;
    transform: translateY(-50%);
    color: #94a3b8;
    font-size: 1rem;
  }
  #pagination .page-link {
    border: none;
    border-radius: 10px;
    color: #4e73df;
  }
  #pagination .page-item.active .page-link {
    background-color: #4e73df;
    color: #fff;
  }
  .hidden {
    display: none !important;
  }
</style>

<script src="{% static 'assets/js/projects_list.js' %}"></script>

{% endblock %}
